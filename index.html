<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Furqan Tuitions | Rayyan</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #0f2027, #203a43, #2c5364); color: #fff; }
    header { padding: 16px; font-size: 22px; font-weight: 600; text-align: center; }
    .container { padding: 16px; max-width: 520px; margin: auto; }
    select { width: 100%; padding: 12px; border-radius: 10px; border: none; margin-bottom: 14px; font-size: 16px; }
    .stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 18px; }
    .stat { background: rgba(255,255,255,0.15); border-radius: 14px; padding: 12px; text-align: center; font-size: 14px; }
    .stat span { display: block; font-size: 20px; font-weight: 600; margin-top: 4px; }
    .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
    .day { padding: 14px 0; border-radius: 12px; background: rgba(255,255,255,0.12); text-align: center; font-size: 14px; cursor: pointer; }
    .taken { background: #1db954; }
    .missed { background: #d9534f; }
    .overall { margin-top: 26px; display: grid; gap: 16px; }
    .card { background: rgba(255,255,255,0.12); border-radius: 14px; padding: 16px; }
    ul { padding-left: 18px; }
    #classModal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.75); align-items: center; justify-content: center; }
    .modal { background: #111; width: 90%; max-width: 320px; padding: 20px; border-radius: 16px; }
    input, button { width: 100%; padding: 12px; margin-top: 12px; border-radius: 10px; border: none; font-size: 15px; }
    button { background: #1db954; color: #fff; font-weight: 600; }
  </style>
</head>
<body>
<header>Furqan Tuitions – Rayyan</header>
<div class="container">
  <select id="monthSelect"></select>  <div class="stats">
    <div class="stat">Total Classes<span id="totalClasses">0</span></div>
    <div class="stat">Taken<span id="takenClasses">0</span></div>
    <div class="stat">Remaining<span id="remainingClasses">0</span></div>
    <div class="stat">Compensatory Left<span id="compensatory">10</span>
      <div id="compControls" style="margin-top:6px; display:none;">
        <button id="compDec" style="margin-right:6px">−1</button>
        <button id="compInc">+1</button>
      </div>
    </div>
  </div>  <div class="calendar" id="calendar"></div>  <div class="overall">
    <div class="card">
      <h3>Maths – Topics</h3>
      <ul id="mathsTopics"></ul>
    </div>
    <div class="card">
      <h3>Physics – Topics</h3>
      <ul id="physicsTopics"></ul>
    </div>
  </div>
</div><div id="classModal">
  <div class="modal">
    <h3>Mark Class</h3>
    <select id="subjectSelect">
      <option value="maths">Maths</option>
      <option value="physics">Physics</option>
    </select>
    <input id="topicInput" placeholder="Topic studied">
    <button id="saveBtn">Save</button>
  </div>
</div><script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getDatabase, ref, onValue, set, update } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

  document.addEventListener("DOMContentLoaded", () => {
    const firebaseConfig = {
      apiKey: "AIzaSyD5iFJYPEU3B0eohoFl_pGD75ZzX-onQsE",
      authDomain: "furqantuitions.firebaseapp.com",
      databaseURL: "https://furqantuitions-default-rtdb.firebaseio.com",
      projectId: "furqantuitions",
      storageBucket: "furqantuitions.appspot.com",
      messagingSenderId: "816451833675",
      appId: "1:816451833675:web:eda7c6a26f8e202effa2ce"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const isTeacher = new URLSearchParams(location.search).get("teacher") === "furqan@admin";

    const calendar = document.getElementById("calendar");
    const monthSelect = document.getElementById("monthSelect");
    const modal = document.getElementById("classModal");
    const saveBtn = document.getElementById("saveBtn");
    const topicInput = document.getElementById("topicInput");
    const subjectSelect = document.getElementById("subjectSelect");

    const totalEl = document.getElementById("totalClasses");
    const takenEl = document.getElementById("takenClasses");
    const remainingEl = document.getElementById("remainingClasses");
    const compEl = document.getElementById("compensatory");
    const compControls = document.getElementById("compControls");
    const compInc = document.getElementById("compInc");
    const compDec = document.getElementById("compDec");

    if (isTeacher) compControls.style.display = "block";

    const mathsTopics = document.getElementById("mathsTopics");
    const physicsTopics = document.getElementById("physicsTopics");

    let selectedDate = "";

    function expectedClassesInMonth(y, m) {
      let count = 0;
      const days = new Date(y, m + 1, 0).getDate();
      for (let d = 1; d <= days; d++) {
        const day = new Date(y, m, d).getDay();
        if ([1,3,6,0].includes(day)) count++; // Mon, Wed, Sat, Sun
      }
      return count;
    }

    function renderCalendar(y, m) {
      calendar.innerHTML = "";
      let takenCount = 0;
      const days = new Date(y, m + 1, 0).getDate();

      for (let d = 1; d <= days; d++) {
        const dayDiv = document.createElement("div");
        dayDiv.className = "day";
        dayDiv.textContent = d;

        const key = `${y}-${m+1}-${d}`;
        const dayRef = ref(db, `rayyan/classes/${key}`);

        onValue(dayRef, snap => {
          dayDiv.classList.remove("taken", "missed");
          if (snap.exists()) {
            dayDiv.classList.add(snap.val().status);
            if (snap.val().status === "taken") takenCount++;
          }
          updateStats(y, m, takenCount);
        });

        dayDiv.onclick = () => {
          selectedDate = key;
          if (isTeacher) modal.style.display = "flex";
        };

        calendar.appendChild(dayDiv);
      }

      updateStats(y, m, takenCount);
    }

    function updateStats(y, m, taken) {
      const total = expectedClassesInMonth(y, m);
      totalEl.textContent = total;
      takenEl.textContent = taken;
      remainingEl.textContent = total - taken; // can be negative
    }

    function loadMonths() {
      const now = new Date();
      for (let i = 0; i < 6; i++) {
        const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
        const opt = document.createElement("option");
        opt.value = `${d.getFullYear()}-${d.getMonth()}`;
        opt.textContent = d.toLocaleString("default", { month: "long", year: "numeric" });
        monthSelect.appendChild(opt);
      }
    }

    monthSelect.onchange = () => {
      const [y, m] = monthSelect.value.split("-");
      renderCalendar(+y, +m);
    };

    saveBtn.onclick = () => {
      if (!selectedDate) return;
      update(ref(db, `rayyan/classes/${selectedDate}`), {
        topic: topicInput.value,
        subject: subjectSelect.value,
        status: "taken"
      });

      update(ref(db, `rayyan/overall/${subjectSelect.value}`), {
        [selectedDate]: topicInput.value
      });

      modal.style.display = "none";
      topicInput.value = "";
    };

    loadMonths();
    const now = new Date();
    renderCalendar(now.getFullYear(), now.getMonth());

    // --- COMPENSATORY ---
    const compRef = ref(db, "rayyan/compensatory");
    onValue(compRef, snap => {
      if (!snap.exists()) {
        set(compRef, 10);
        compEl.textContent = 10;
      } else {
        compEl.textContent = snap.val();
      }
    });

    if (isTeacher) {
      compInc.onclick = () => set(compRef, Number(compEl.textContent) + 1);
      compDec.onclick = () => set(compRef, Number(compEl.textContent) - 1);
    }

    // Load overall topics
    const overallRef = ref(db, "rayyan/overall");
    onValue(overallRef, snap => {
      mathsTopics.innerHTML = physicsTopics.innerHTML = "";
      Object.values(snap.val()?.maths || {}).forEach(t => mathsTopics.innerHTML += `<li>${t}</li>`);
      Object.values(snap.val()?.physics || {}).forEach(t => physicsTopics.innerHTML += `<li>${t}</li>`);
    });
  });
</script></body>
</html>    
      
